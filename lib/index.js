"use strict";

var _botkit = _interopRequireDefault(require("botkit"));

var _MediBot = require("./MediBot");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Check that env variables were setup
if (process.env.access_token && process.env.verify_token && process.env.PORT) {
  // Create facebook bot controller (for events)
  var controller = _botkit.default.facebookbot({
    access_token: process.env.access_token,
    verify_token: process.env.verify_token
  }); // Create facebook bot (for replies)


  var bot = controller.spawn(); // Create a basic webserver (Express)

  controller.setupWebserver(process.env.PORT, function (err, webserver) {
    if (err) {
      console.error(err);
    } // Setup webhook endpoints for Facebook to connect to bot


    controller.createWebhookEndpoints(webserver, bot, function () {
      console.log('StoryBot is online.');
    });
  }); // Called when a message is received

  controller.on('message_received', function (bot, message) {
    (0, _MediBot.messageReceived)(bot, message);
  });
} else {
  console.error('Required environment variables not found.');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiYWNjZXNzX3Rva2VuIiwidmVyaWZ5X3Rva2VuIiwiUE9SVCIsImNvbnRyb2xsZXIiLCJCb3RraXQiLCJmYWNlYm9va2JvdCIsImJvdCIsInNwYXduIiwic2V0dXBXZWJzZXJ2ZXIiLCJlcnIiLCJ3ZWJzZXJ2ZXIiLCJjb25zb2xlIiwiZXJyb3IiLCJjcmVhdGVXZWJob29rRW5kcG9pbnRzIiwibG9nIiwib24iLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUVBOzs7O0FBRUE7QUFDQSxJQUFJQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsWUFBWixJQUE0QkYsT0FBTyxDQUFDQyxHQUFSLENBQVlFLFlBQXhDLElBQXdESCxPQUFPLENBQUNDLEdBQVIsQ0FBWUcsSUFBeEUsRUFBOEU7QUFDNUU7QUFDQSxNQUFNQyxVQUFVLEdBQUdDLGdCQUFPQyxXQUFQLENBQW1CO0FBQ3BDTCxJQUFBQSxZQUFZLEVBQUVGLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxZQURVO0FBRXBDQyxJQUFBQSxZQUFZLEVBQUVILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRTtBQUZVLEdBQW5CLENBQW5CLENBRjRFLENBTzVFOzs7QUFDQSxNQUFNSyxHQUFHLEdBQUdILFVBQVUsQ0FBQ0ksS0FBWCxFQUFaLENBUjRFLENBVTVFOztBQUNBSixFQUFBQSxVQUFVLENBQUNLLGNBQVgsQ0FDRVYsT0FBTyxDQUFDQyxHQUFSLENBQVlHLElBRGQsRUFFRSxVQUFDTyxHQUFELEVBQWFDLFNBQWIsRUFBZ0Q7QUFDOUMsUUFBSUQsR0FBSixFQUFTO0FBQ1BFLE1BQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjSCxHQUFkO0FBQ0QsS0FINkMsQ0FLOUM7OztBQUNBTixJQUFBQSxVQUFVLENBQUNVLHNCQUFYLENBQWtDSCxTQUFsQyxFQUE2Q0osR0FBN0MsRUFBa0QsWUFBTTtBQUN0REssTUFBQUEsT0FBTyxDQUFDRyxHQUFSLENBQVkscUJBQVo7QUFDRCxLQUZEO0FBR0QsR0FYSCxFQVg0RSxDQXlCNUU7O0FBQ0FYLEVBQUFBLFVBQVUsQ0FBQ1ksRUFBWCxDQUFjLGtCQUFkLEVBQWtDLFVBQUNULEdBQUQsRUFBTVUsT0FBTixFQUFrQjtBQUNsRCxrQ0FBZ0JWLEdBQWhCLEVBQXFCVSxPQUFyQjtBQUNELEdBRkQ7QUFHRCxDQTdCRCxNQTZCTztBQUNMTCxFQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYywyQ0FBZDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvdGtpdCBmcm9tICdib3RraXQnO1xuaW1wb3J0IEV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBtZXNzYWdlUmVjZWl2ZWQgfSBmcm9tICcuL01lZGlCb3QnO1xuXG4vLyBDaGVjayB0aGF0IGVudiB2YXJpYWJsZXMgd2VyZSBzZXR1cFxuaWYgKHByb2Nlc3MuZW52LmFjY2Vzc190b2tlbiAmJiBwcm9jZXNzLmVudi52ZXJpZnlfdG9rZW4gJiYgcHJvY2Vzcy5lbnYuUE9SVCkge1xuICAvLyBDcmVhdGUgZmFjZWJvb2sgYm90IGNvbnRyb2xsZXIgKGZvciBldmVudHMpXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBCb3RraXQuZmFjZWJvb2tib3Qoe1xuICAgIGFjY2Vzc190b2tlbjogcHJvY2Vzcy5lbnYuYWNjZXNzX3Rva2VuLFxuICAgIHZlcmlmeV90b2tlbjogcHJvY2Vzcy5lbnYudmVyaWZ5X3Rva2VuLFxuICB9KTtcblxuICAvLyBDcmVhdGUgZmFjZWJvb2sgYm90IChmb3IgcmVwbGllcylcbiAgY29uc3QgYm90ID0gY29udHJvbGxlci5zcGF3bigpO1xuXG4gIC8vIENyZWF0ZSBhIGJhc2ljIHdlYnNlcnZlciAoRXhwcmVzcylcbiAgY29udHJvbGxlci5zZXR1cFdlYnNlcnZlcihcbiAgICBwcm9jZXNzLmVudi5QT1JULFxuICAgIChlcnI6IEVycm9yLCB3ZWJzZXJ2ZXI6IEV4cHJlc3MuQXBwbGljYXRpb24pID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXR1cCB3ZWJob29rIGVuZHBvaW50cyBmb3IgRmFjZWJvb2sgdG8gY29ubmVjdCB0byBib3RcbiAgICAgIGNvbnRyb2xsZXIuY3JlYXRlV2ViaG9va0VuZHBvaW50cyh3ZWJzZXJ2ZXIsIGJvdCwgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnU3RvcnlCb3QgaXMgb25saW5lLicpO1xuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIC8vIENhbGxlZCB3aGVuIGEgbWVzc2FnZSBpcyByZWNlaXZlZFxuICBjb250cm9sbGVyLm9uKCdtZXNzYWdlX3JlY2VpdmVkJywgKGJvdCwgbWVzc2FnZSkgPT4ge1xuICAgIG1lc3NhZ2VSZWNlaXZlZChib3QsIG1lc3NhZ2UpO1xuICB9KTtcbn0gZWxzZSB7XG4gIGNvbnNvbGUuZXJyb3IoJ1JlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlcyBub3QgZm91bmQuJyk7XG59XG4iXX0=